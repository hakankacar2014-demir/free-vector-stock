<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bulk Auto-Upload Panel | Free Vector Stock</title>
    <style>
        body { background: #000; color: #fff; font-family: 'Segoe UI', Tahoma, sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .upload-box { background: #111; padding: 40px; border-radius: 20px; border: 2px solid #f39c12; width: 480px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        h2 { color: #f39c12; text-transform: uppercase; margin-bottom: 10px; font-size: 22px; }
        .description { color: #777; font-size: 13px; margin-bottom: 30px; line-height: 1.4; }
        input[type="password"] { width: 100%; padding: 14px; margin: 10px 0; border-radius: 8px; border: 1px solid #333; background: #222; color: white; box-sizing: border-box; outline: none; transition: 0.3s; }
        input[type="password"]:focus { border-color: #f39c12; }
        .btn-select { background: #222; color: #f39c12; padding: 12px; border-radius: 8px; cursor: pointer; display: block; margin: 15px 0; border: 1px dashed #f39c12; width: 100%; font-weight: bold; transition: 0.2s; }
        .btn-select:hover { background: #f39c12; color: #000; }
        .btn-upload { background: #27ae60; color: #fff; padding: 16px; border-radius: 8px; font-weight: bold; cursor: pointer; border: none; width: 100%; font-size: 16px; margin-top: 10px; transition: 0.3s; }
        .btn-upload:hover { background: #2ecc71; transform: translateY(-2px); }
        #log { margin-top: 20px; font-size: 12px; text-align: left; max-height: 200px; overflow-y: auto; color: #bbb; border-top: 1px solid #222; padding-top: 15px; font-family: 'Courier New', monospace; }
        .file-status { color: #f39c12; font-weight: bold; display: block; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="upload-box">
    <h2>BULK AUTO-UPLOAD</h2>
    <p class="description">Upload multiple designs at once. Folder names are automatically generated from your JPG filenames.</p>
    
    <input type="password" id="ghToken" placeholder="GitHub Personal Access Token (ghp_...)">
    
    <input type="file" id="fileInput" multiple accept=".jpg,.jpeg,.eps" style="display: none;" onchange="updateUI()">
    <button class="btn-select" onclick="document.getElementById('fileInput').click()">SELECT JPG & EPS FILES</button>
    
    <span id="fileCount" class="file-status">No files selected</span>
    
    <button class="btn-upload" onclick="startBulkUpload()">START UPLOAD PROCESS</button>
    
    <div id="log"></div>
</div>

<script>
    // Update the UI when files are selected
    function updateUI() {
        const files = document.getElementById('fileInput').files;
        document.getElementById('fileCount').innerText = files.length > 0 ? files.length + " files ready to upload." : "No files selected";
    }

    async function startBulkUpload() {
        const token = document.getElementById('ghToken').value;
        const files = Array.from(document.getElementById('fileInput').files);
        const log = document.getElementById('log');

        if (!token) { alert("Please enter your GitHub Token!"); return; }
        if (files.length === 0) { alert("Please select some files first!"); return; }

        log.innerHTML = "üöÄ <b>Starting Bulk Upload...</b><br>";

        // Filter out JPG files to define folders
        const jpgFiles = files.filter(f => f.name.toLowerCase().endsWith('.jpg') || f.name.toLowerCase().endsWith('.jpeg'));

        for (let jpgFile of jpgFiles) {
            const fileNameBase = jpgFile.name.split('.')[0]; 
            const folderName = fileNameBase.toLowerCase().replace(/\s+/g, '-'); // Auto-create folder name
            
            // Find the matching EPS file with the same name
            const epsFile = files.find(f => f.name.split('.')[0] === fileNameBase && f.name.toLowerCase().endsWith('.eps'));

            if (epsFile) {
                log.innerHTML += `üìÅ Folder: <b>${folderName}</b>`;
                
                // Upload both files to GitHub
                const jpgResult = await uploadToGithub(jpgFile, folderName, token);
                const epsResult = await uploadToGithub(epsFile, folderName, token);
                
                if(jpgResult && epsResult) {
                    log.innerHTML += ` - <span style="color:#2ecc71">COMPLETED</span><br>`;
                } else {
                    log.innerHTML += ` - <span style="color:#e74c3c">FAILED</span><br>`;
                }
            } else {
                log.innerHTML += `‚ö†Ô∏è <b>Skipped:</b> No matching EPS found for "${fileNameBase}"<br>`;
            }
        }
        log.innerHTML += "<br>üèÅ <b>All tasks finished!</b>";
    }

    async function uploadToGithub(file, folder, token) {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        return new Promise(resolve => {
            reader.onload = async () => {
                const base64Content = reader.result.split(',')[1];
                const uploadPath = `vectors/${folder}/${file.name}`;
                
                try {
                    const response = await fetch(`https://api.github.com/repos/free-vector-stock/free-vector-stock/contents/${uploadPath}`, {
                        method: 'PUT',
                        headers: { 'Authorization': `token ${token}`, 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            message: `Auto-upload: ${folder}`,
                            content: base64Content
                        })
                    });
                    resolve(response.ok);
                } catch (error) {
                    console.error("Upload error:", error);
                    resolve(false);
                }
            };
        });
    }
</script>
</body>
</html>
